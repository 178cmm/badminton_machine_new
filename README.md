# 羽毛球發球機控制系統

## 概述

這是一個功能完整的羽毛球發球機控制系統，支援多種訓練模式和智能語音控制。系統提供直觀的圖形界面，讓用戶可以輕鬆控制發球機進行各種訓練。

## 主要功能

### 🎯 手動控制模式
- **單發模式**：點擊位置按鈕直接發送一顆球
- **連發模式**：設定球數和間隔，連續發送多顆球到指定位置
- **25宮格發球區域**：前場、中場、後場精準控制

### 🎙️ 語音控制系統
- **Whisper API 語音識別**：高準確度語音轉文字
- **智能規則匹配**：自動識別訓練指令
- **TTS 語音回覆**：即時語音反饋
- **VAD 自動偵測**：智能語音活動偵測

### 🏃‍♂️ 訓練模式
- **基礎訓練**：單一球路反覆練習
- **進階訓練**：多球路組合訓練
- **模擬對打**：智能對打模擬（12個等級）
- **熱身模式**：系統化熱身訓練

### 📱 用戶界面
- **連接管理**：藍牙設備掃描和連接
- **實時監控**：訓練進度和狀態顯示
- **日誌記錄**：詳細的操作記錄
- **文字指令**：支援文字輸入控制

## 系統架構

```
羽毛球發球機控制系統/
├── main.py                 # 主程式入口
├── gui/                    # 圖形界面模組
│   ├── main_gui.py        # 主界面
│   ├── ui_control.py      # 手動控制界面
│   ├── ui_voice.py        # 語音控制界面
│   ├── ui_training.py     # 訓練模式界面
│   └── ...
├── core/                   # 核心功能模組
│   ├── executors/         # 執行器
│   ├── parsers/           # 解析器
│   └── managers/          # 管理器
├── voice_control_tts.py   # 語音控制主程式
├── voice_control.py       # 語音控制（Vosk版本）
└── requirements.txt       # 依賴套件
```

## 安裝與使用

### 環境要求
- Python 3.8+
- PyQt5
- OpenAI API Key（語音控制功能）

### 安裝步驟
1. 克隆專案
```bash
git clone <repository-url>
cd coding_1
```

2. 安裝依賴
```bash
pip install -r requirements.txt
```

3. 設定 OpenAI API Key
```bash
export OPENAI_API_KEY="your-api-key-here"
```

4. 啟動程式
```bash
python main.py
```

### 快速開始（simulate）

若要在無實機情境下端到端演練：

1. 設定模擬模式（依您的環境其一）：
```bash
export SIMULATE=true
# 或在設定檔/程式啟動參數中設 simulate=true
```

2. 執行端到端腳本：
```bash
python tools/sim_e2e.py
```

3. 查看審計日誌：
```bash
tail -f logs/commands.jsonl
```

（選）更新 golden log 與跑測試：
```bash
pytest -k sim  # 依您的測試套件標記
# 或將本次正確輸出覆寫為 golden（專案若提供對應工具）
```

## 使用指南

### 手動控制
1. 切換到「手動控制」標籤頁
2. 選擇發球模式（單發/連發）
3. 點擊目標位置按鈕
4. 在連發模式下設定球數和間隔
5. 點擊「開始連發」執行

### 語音控制
1. 切換到「語音控制」標籤頁
2. 設定 OpenAI API Key
3. 選擇音訊裝置
4. 點擊「啟動語音控制」
5. 說出訓練指令（如：「前場練習」、「快速發球」）

### 訓練模式
1. 切換到「基礎訓練」或「進階訓練」標籤頁
2. 選擇訓練課程
3. 設定訓練參數
4. 點擊「開始訓練」

## 技術特色

### 智能語音控制
- 使用 OpenAI Whisper API 進行高精度語音識別
- 支援自然語言指令處理
- 智能規則匹配系統
- 即時語音回覆功能

### 異步處理
- 非阻塞式 UI 設計
- 異步藍牙通訊
- 多線程語音處理
- 實時狀態更新

### 模組化設計
- 清晰的代碼結構
- 可擴展的架構
- 獨立的執行器和解析器
- 統一的錯誤處理

## 配置檔案

### area.json
發球區域配置檔案，定義25個發球位置的參數。

### training_programs.json
訓練課程配置檔案，包含各種訓練模式的設定。

### badminton_rules.yaml
語音控制規則檔案，定義語音指令的匹配規則。

## 故障排除

### 常見問題
1. **藍牙連接失敗**：檢查發球機電源和藍牙狀態
2. **語音識別不準確**：確認網路連接和 API Key 設定
3. **發球機無響應**：檢查藍牙連接和發球機狀態

### 日誌查看
系統會自動記錄詳細的操作日誌，可在「日誌」標籤頁查看。

## 開發者資訊

### 代碼結構
- `gui/`：圖形界面相關代碼
- `core/`：核心業務邏輯
- `voice_control*.py`：語音控制實現
- `commands.py`：指令處理
- `bluetooth.py`：藍牙通訊

### 擴展開發
系統採用模組化設計，可以輕鬆添加新的訓練模式或控制方式。

## 版本歷史

### v1.0.0
- 實現基本手動控制功能
- 添加語音控制系統
- 支援多種訓練模式
- 實現連發模式功能

## 授權

本專案採用 MIT 授權條款。

## 聯絡資訊

如有問題或建議，請聯繫開發團隊。
